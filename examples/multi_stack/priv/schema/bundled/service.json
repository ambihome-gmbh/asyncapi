{
    "asyncapi": "3.0.0",
    "info": {
        "title": "MultiStack API",
        "version": "0.0.1",
        "description": "API for stacks with push and pop operations"
    },
    "x-testcases": [
        {
            "name": "create, push, pop - ok",
            "sequence": [
                "user->service: create/{name: 'SomeName'}",
                "service->user: create_response/{name: 'SomeName', id: stack_id}",
                "user->service: push[stack_id: $stack_id]/{value: 42}",
                "user->service: pop[stack_id: $stack_id]",
                "service->user: pop_response[stack_id: $stack_id]/{value: 42}"
            ]
        }
    ],
    "defaultContentType": "application/json",
    "servers": {
        "production": {
            "host": "127.0.0.1",
            "protocol": "mqtt",
            "description": "Test broker",
            "variables": {
                "port": {
                    "description": "MQTT port",
                    "default": "1883",
                    "enum": [
                        "1883"
                    ]
                }
            }
        }
    },
    "channels": {
        "create": {
            "address": "stack/create",
            "title": "Create channel",
            "messages": {
                "create-message": {
                    "name": "Create",
                    "payload": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string"
                            }
                        },
                        "required": [
                            "name"
                        ]
                    },
                    "examples": [
                        {
                            "name": "create: SomeName",
                            "payload": {
                                "name": "SomeName"
                            }
                        }
                    ]
                }
            },
            "description": "Channel for pushing values onto the stack"
        },
        "create_response": {
            "address": "stack/create_response",
            "messages": {
                "create-message": {
                    "name": "CreateResponse",
                    "payload": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "string"
                            },
                            "name": {
                                "type": "string"
                            }
                        },
                        "required": [
                            "id",
                            "name"
                        ]
                    }
                }
            }
        },
        "push": {
            "address": "stack/push/{stack_id}",
            "parameters": {
                "stack_id": {
                    "description": "ID of the stack"
                }
            },
            "title": "Push channel",
            "messages": {
                "push-message": {
                    "name": "Push",
                    "payload": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": "integer"
                            }
                        },
                        "required": [
                            "value"
                        ]
                    },
                    "examples": [
                        {
                            "name": "push: 42",
                            "payload": {
                                "value": 42
                            }
                        }
                    ]
                }
            },
            "description": "Channel for pushing values onto the stack"
        },
        "pop": {
            "address": "stack/pop/{stack_id}",
            "parameters": {
                "stack_id": {
                    "description": "ID of the stack"
                }
            },
            "title": "Pop channel",
            "messages": {
                "pop-message": {
                    "name": "pop",
                    "payload": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {}
                    },
                    "examples": [
                        {
                            "name": "pop",
                            "payload": {}
                        }
                    ]
                }
            },
            "description": "Channel for popping values from the stack"
        },
        "pop_response": {
            "address": "stack/pop/response/{stack_id}",
            "parameters": {
                "stack_id": {
                    "description": "ID of the stack"
                }
            },
            "title": "Pop Response channel",
            "messages": {
                "pop-response-message": {
                    "name": "PopResponse",
                    "payload": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": [
                                    "integer",
                                    "null"
                                ]
                            }
                        },
                        "required": [
                            "value"
                        ]
                    },
                    "examples": [
                        {
                            "name": "pop-response: 42",
                            "payload": {
                                "value": 42
                            }
                        },
                        {
                            "name": "pop-response: empty",
                            "payload": {
                                "value": null
                            }
                        }
                    ]
                }
            },
            "description": "Channel for receiving responses after popping values from the stack"
        }
    },
    "operations": {
        "create": {
            "action": "receive",
            "channel": {
                "$ref": "#/channels/create"
            },
            "reply": {
                "channel": {
                    "$ref": "#/channels/create_response"
                }
            }
        },
        "push": {
            "action": "receive",
            "channel": {
                "$ref": "#/channels/push"
            }
        },
        "pop": {
            "action": "receive",
            "channel": {
                "$ref": "#/channels/pop"
            },
            "reply": {
                "channel": {
                    "$ref": "#/channels/pop_response"
                }
            }
        },
        "pop_response": {
            "action": "send",
            "channel": {
                "$ref": "#/channels/pop_response"
            }
        },
        "create_response": {
            "action": "send",
            "channel": {
                "$ref": "#/channels/create_response"
            }
        }
    },
    "components": {
        "schemas": {
            "empty": {
                "type": "object",
                "additionalProperties": false,
                "properties": {}
            },
            "pop_response": {
                "type": "object",
                "properties": {
                    "value": {
                        "type": [
                            "integer",
                            "null"
                        ]
                    }
                },
                "required": [
                    "value"
                ]
            },
            "create_response": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    }
                },
                "required": [
                    "id",
                    "name"
                ]
            },
            "create": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string"
                    }
                },
                "required": [
                    "name"
                ]
            },
            "push": {
                "type": "object",
                "properties": {
                    "value": {
                        "type": "integer"
                    }
                },
                "required": [
                    "value"
                ]
            }
        },
        "parameters": {
            "stack_id": {
                "description": "ID of the stack"
            }
        }
    }
}