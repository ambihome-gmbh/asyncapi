asyncapi: "3.0.0"

channels:
  functions-request:
    address: functions/req/all
    title: Functions request
    messages:
      filtered functions request:
        payload:
          $ref: "#/components/schemas/filter"

  functions-response:
    address: functions/resp/all
    title: Functions Response
    messages:
      all function instances:
        payload:
          $ref: "#/components/schemas/functions"

  function-request:
    address: functions/req/{instance_id}
    title: Function Request
    messages:
      empty:
        payload:
          $ref: "#/components/schemas/empty"

  function-response:
    address: functions/resp/{instance_id}
    title: Function Response
    messages:
      function instance:
        payload:
          $ref: "#/components/schemas/function"

  datapoints-request:
    address: datapoints/req/all
    title: Datapoints Request
    messages:
      filtered datapoints request:
        payload:
          $ref: "#/components/schemas/filter"

  datapoints-response:
    address: datapoints/resp/all
    title: Datapoints Request
    messages:
      all datapoint instances:
        payload:
          $ref: "#/components/schemas/datapoints"

  datapoint-request:
    address: datapoint/req/{instance_id}
    title: Datapoint Request
    messages:
      empty:
        payload:
          $ref: "#/components/schemas/empty"

  datapoint-response:
    address: datapoint/resp/{instance_id}
    title: Datapoint Response
    messages:
      datapoint instance:
        payload:
          $ref: "#/components/schemas/datapoint"

  locations-request:
    address: locations/req/all
    title: Locations Request
    messages:
      filtered locations request:
        payload:
          $ref: "#/components/schemas/filter"

  locations-response:
    address: locations/resp/all
    title: Locations Response
    messages:
      all location instances:
        payload:
          $ref: "#/components/schemas/locations"

  location-request:
    address: location/req/{instance_id}
    title: Location Request
    messages:
      empty:
        payload:
          $ref: "#/components/schemas/empty"

  location-response:
    address: location/resp/{instance_id}
    title: Location Response
    messages:
      location instance:
        payload:
          $ref: "#/components/schemas/location"

  datapoint-write-request:
    address: datapoint-write/req/{instance_id}
    title: Datapoint Write Request
    messages:
      datapoint write:
        payload:
          $ref: "#/components/schemas/datapoint-write"

  datapoint-write-indication:
    address: datapoint-write/ind/{instance_id}
    title: Datapoint Write Indication
    messages:
      datapoint write:
        payload:
          $ref: "#/components/schemas/datapoint-write"

components:
  parameters:
    instance_id:
      description: ID of the instance

  schemas:
    function:
      $ref: "./function.yaml#/function"

    functions:
      type: array
      items:
        $ref: "#/components/schemas/function"

    location:
      $ref: "./location.yaml#/location"

    locations:
      type: array
      items:
        $ref: "#/components/schemas/location"

    datapoint:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          const: datapoint
        datapoint_ref:
          # TODO
          # $ref: "./definitions.yaml#/$defs/datapoint"
          type: string
        title:
          type: string
        function_ref:
          type: string
          format: uuid
      required:
        - id
        - type
        - title
        - datapoint_ref
        - function_ref
      additionalProperties: false

    datapoints:
      type: array
      items:
        $ref: "#/components/schemas/datapoint"

    datapoint-write:
      $ref: "./datapoint-write.json#/datapoint-write"
      # type: string

    filter:
      type: object
      properties:
        foo:
          type: string
      required:
        - foo
      additionalProperties: false

    empty:
      type: object
      additionalProperties: false
